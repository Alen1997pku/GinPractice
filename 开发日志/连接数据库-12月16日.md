# 连接数据库-12月16日

## 前言

### 回顾

相信经过前面的代码。大家应该已经大致了解后端到底是一个怎么样的工作模式，总的来说，就是浏览器发来一个请求。我这边要回复一个结果。此外，浏览器的请求信息是保存在两个地方，一个就是路由信息，就是浏览器最上方的url（也包括存在url里面的参数，这部分是暴露的）。还有一部分是在请求体了，也就是请求的主主体部分，可以是JSON、form、数组、等等。

### 什么是数据库

我们在前面开发时，将用户信息（admin、123456）保存在一张map里面。这显然是不太妥当的，这就意味着用户信息数据在内存中，是不稳定的。那么，我们可以不可以用一种方式将信息保存在硬盘上，这样就是程序挂掉了，用户的信息也不会消失？自然的，我们可以想起来，我们可以用一个文本文档将用户信息数据存起来。这样每次去查的时候就打开这个文本文档，然后进行查询。这无疑是低效的。因为总是要打开，然后进行一次遍历，如果有多种信息数据，就要保存在多个文档，就要有大量的代码取管理这些信息。
有没有什么办法可以帮助我们管理这些数据呢？答案就是数据库。你可以理解数据库就是一个帮你管理数据的软件，每次你想获取你要的数据，只要告诉这个软件，他就会帮你找出来，然后把信息告诉你。

## 开发目的：将用户信息保存在数据库中

现在既然我们已经知道为什么要用数据库了。那怎么使用他呢？我们前面知道当我们要打开一个服务器的网站时，是需要ip地址和端口，其中，ip是用来告诉服务器在互联网中的位置、而端口号是告诉我们要通讯的软件是监听哪个端口。
是的，当我们要连接数据库是也是需要这两个信息的，一个是ip地址，一个是端口号。同学们应该可以自然的想到，就像我们登录微信，也是需要账号和密码的。好了，接下来就一起来看代码把。这部分内容我会放到conf文件中，因为这属于整个后端架构的基础配置部分。

## 修改了哪些代码

* main.go文件中，增加了`err := conf.DBInit("root:123456@(127.0.0.1:3306)/ginpractice?charset=utf8mb4")`这段代码
* 增加了conf文件夹，其中database.go增加了初始化数据库连接的部分
* 删除了useinfo文件夹，并将用户信息转到users文件夹中
* users.go文件增加了与数据库查询的部分

## 当前状态

增加了与数据库通讯的部分，因为出于展示过程的目的，我使用的是go语言自带的sql标准库，因此许多做法不够优雅。
也因此我向大家提出几个问题：

* 数据如何自动向数据库迁移
* 查询过程能不能再封装一下，
* 不要每次都要遍历得到的列？
* 如何设计数据库使我们的用户信息能够存放的更加整洁？

## 下个版本

在下个版本中，我将会使用目前比较好用的第三方数据库管理包，是jinzhu的gorm包。在这个包的管理下，许多当前存在的问题都可以被很优雅的解决。

## 如何运行

这次的代码在运行之前，我们需要安装mysql，然后登录mysql，在mysql中输入

```mysql
    create database ginpractice;
    use ginpractice;
    create table users (username char(10),password char(10));
    insert into users(username,password)values('admin','123456');
```

ok 接下来还是向往常一样在控制台输入 go run main.go 就可以啦
